ARG CODE_VERSION
FROM clipper/py-rpc:${CODE_VERSION}

COPY clipper_admin/clipper_admin/python_container_conda_deps.txt /lib/

RUN apt-get update --fix-missing \
      && apt-get install -yqq openjdk-8-jdk \
      && conda config --set ssl_verify no
RUN conda install -y --file /lib/python_container_conda_deps.txt
RUN pip install pyspark

COPY containers/python/pyspark_container.py containers/python/pyspark_container_entry.sh /container/

CMD ["/container/pyspark_container_entry.sh"]

# vim: set filetype=dockerfile:
